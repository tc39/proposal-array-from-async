<!doctype html>
<head><meta charset="utf-8"><title>ES Array.fromAsync (2022)</title><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.0.1/styles/base16/solarized-light.min.css"></head><body><div id="shortcuts-help">
<ul>
  <li><span>Toggle shortcuts help</span><code>?</code></li>
  <li><span>Toggle "can call user code" annotations</span><code>u</code></li>

  <li><span>Jump to search box</span><code>/</code></li>
</ul></div><div id="menu-toggle"><svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%; stroke:currentColor" viewBox="0 0 120 120">
      <title>Menu</title>
      <path stroke-width="10" stroke-linecap="round" d="M30,60 h60  M30,30 m0,5 h60  M30,90 m0,-5 h60"></path>
    </svg></div><div id="menu-spacer" class="menu-spacer"></div><div id="menu"><div id="menu-search"><input type="text" id="menu-search-box" placeholder="Search..."><div id="menu-search-results" class="inactive"></div></div><div id="menu-pins"><div class="menu-pane-header">Pins</div><ul id="menu-pins-list"></ul></div><div class="menu-pane-header">Table of Contents</div><div id="menu-toc"><ol class="toc"><li><span class="item-toggle-none"></span><a href="#introduction" title="Introduction">Introduction</a></li><li><span class="item-toggle">‚ó¢</span><a href="#sec-control-abstraction-objects" title="Control Abstraction Objects"><span class="secnum">1</span> Control Abstraction Objects</a><ol class="toc"><li><span class="item-toggle">‚ó¢</span><a href="#sec-iteration" title="Iteration"><span class="secnum">1.1</span> Iteration</a><ol class="toc"><li><span class="item-toggle">‚ó¢</span><a href="#sec-iterator-abstract-operations" title="Iterator Abstract Operations"><span class="secnum">1.1.1</span> Iterator Abstract Operations</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-ifabruptcloseasynciterator" title="IfAbruptCloseAsyncIterator ( value, iteratorRecord )"><span class="secnum">1.1.1.1</span> IfAbruptCloseAsyncIterator ( <var>value</var>, <var>iteratorRecord</var> )</a></li></ol></li></ol></li><li><span class="item-toggle">‚ó¢</span><a href="#sec-async-function-objects" title="AsyncFunction Objects"><span class="secnum">1.2</span> AsyncFunction Objects</a><ol class="toc"><li><span class="item-toggle">‚ó¢</span><a href="#sec-async-functions-abstract-operations" title="Async Functions Abstract Operations"><span class="secnum">1.2.1</span> Async Functions Abstract Operations</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-asyncblockstart" title="AsyncBlockStart ( promiseCapability, asyncBody, asyncContext )"><span class="secnum">1.2.1.1</span> AsyncBlockStart ( <var>promiseCapability</var>, <var>asyncBody</var>, <var>asyncContext</var> )</a></li></ol></li></ol></li></ol></li><li><span class="item-toggle">‚ó¢</span><a href="#sec-indexed-collections" title="Indexed Collections"><span class="secnum">2</span> Indexed Collections</a><ol class="toc"><li><span class="item-toggle">‚ó¢</span><a href="#sec-array-objects" title="Array Objects"><span class="secnum">2.1</span> Array Objects</a><ol class="toc"><li><span class="item-toggle">‚ó¢</span><a href="#sec-properties-of-the-array-constructor" title="Properties of the Array Constructor"><span class="secnum">2.1.1</span> Properties of the Array Constructor</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-array.fromAsync" title="Array.fromAsync ( asyncItems [ , mapfn [ , thisArg ] ] )"><span class="secnum">2.1.1.1</span> <ins>Array.fromAsync ( <var>asyncItems</var> [ , <var>mapfn</var> [ , <var>thisArg</var> ] ] )</ins></a></li></ol></li></ol></li></ol></li></ol></div></div><div id="spec-container"><h1 class="version">Stage 1 Draft / May 11, 2023</h1><h1 class="title">ES Array.fromAsync (2022)</h1>
<script src="ecmarkup.js" defer=""></script>
<link rel="stylesheet" href="ecmarkup.css">

<emu-intro id="introduction">
  <h1>Introduction</h1>
  <p>This is the formal specification for a proposed <code>Array.fromAsync</code> factory method
  in JavaScript. It modifies the original <a href="https://tc39.github.io/ecma262/">ECMAScript specification</a> with
  several new or revised clauses. See <a href="https://github.com/js-choi/proposal-array-async-from/blob/main/README.md">the proposal's
  explainer</a> for the proposal's background, motivation, and usage examples.</p>
</emu-intro>

<emu-clause id="sec-control-abstraction-objects">
  <h1><span class="secnum">1</span> Control Abstraction Objects</h1>

  <emu-clause id="sec-iteration">
    <h1><span class="secnum">1.1</span> Iteration</h1>

    <emu-clause id="sec-iterator-abstract-operations">
      <h1><span class="secnum">1.1.1</span> Iterator Abstract Operations</h1>

      <emu-clause id="sec-ifabruptcloseasynciterator">
        <h1><span class="secnum">1.1.1.1</span> IfAbruptCloseAsyncIterator ( <var>value</var>, <var>iteratorRecord</var> )</h1>
        <p><dfn>IfAbruptCloseAsyncIterator</dfn> is a shorthand for a sequence of algorithm steps that use an <emu-xref href="#sec-iterator-records"><a href="https://tc39.es/ecma262/#sec-iterator-records">Iterator Record</a></emu-xref>. An algorithm step of the form:</p>
        <emu-alg><ol><li><emu-xref href="#sec-ifabruptcloseasynciterator" id="_ref_1"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>value</var>, <var>iteratorRecord</var>).</li></ol></emu-alg>
        <p>means the same thing as:</p>
        <emu-alg><ol><li>If <var>value</var> is an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>, then<ol><li>Perform ?&nbsp;<emu-xref aoid="AsyncIteratorClose"><a href="https://tc39.es/ecma262/#sec-asynciteratorclose">AsyncIteratorClose</a></emu-xref>(<var>iteratorRecord</var>, <var>value</var>).</li><li>Return <var>value</var>.</li></ol></li><li>Else if <var>value</var> is a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">Completion Record</a></emu-xref>, set <var>value</var> to <var>value</var>.[[Value]].</li></ol></emu-alg>
      </emu-clause>
    </emu-clause>
  </emu-clause>

  <emu-clause id="sec-async-function-objects">
    <h1><span class="secnum">1.2</span> AsyncFunction Objects</h1>
    <emu-clause id="sec-async-functions-abstract-operations">
      <h1><span class="secnum">1.2.1</span> Async Functions Abstract Operations</h1>
      <emu-clause id="sec-asyncblockstart" type="abstract operation" aoid="AsyncBlockStart">
        <h1><span class="secnum">1.2.1.1</span> AsyncBlockStart ( <var>promiseCapability</var>, <var>asyncBody</var>, <var>asyncContext</var> )</h1>
        <p>The abstract operation AsyncBlockStart takes arguments <var>promiseCapability</var> (a <emu-xref href="#sec-promisecapability-records"><a href="https://tc39.es/ecma262/#sec-promisecapability-records">PromiseCapability Record</a></emu-xref>), <var>asyncBody</var> (a <emu-xref href="#sec-syntactic-grammar"><a href="https://tc39.es/ecma262/#sec-syntactic-grammar">Parse Node</a></emu-xref> <ins>or an <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with no parameters</ins>), and <var>asyncContext</var> (an <emu-xref href="#sec-execution-contexts"><a href="https://tc39.es/ecma262/#sec-execution-contexts">execution context</a></emu-xref>). It performs the following steps when called:</p>
        <emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>promiseCapability</var> is a <emu-xref href="#sec-promisecapability-records"><a href="https://tc39.es/ecma262/#sec-promisecapability-records">PromiseCapability Record</a></emu-xref>.</li><li>Let <var>runningContext</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li fence-effects="user-code">Set the code evaluation state of <var>asyncContext</var> such that when evaluation is resumed for that <emu-xref href="#sec-execution-contexts"><a href="https://tc39.es/ecma262/#sec-execution-contexts">execution context</a></emu-xref> the following steps will be performed:<ol><li><ins> If <var>asyncBody</var> is a <emu-xref href="#sec-syntactic-grammar"><a href="https://tc39.es/ecma262/#sec-syntactic-grammar">Parse Node</a></emu-xref>, then</ins><ol><li><ins> Let <var>result</var> be the result of evaluating <var>asyncBody</var>.</ins></li></ol></li><li><ins> Else, </ins><ol><li><ins> <emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>asyncBody</var> is an <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with no parameters.</ins></li><li><ins> Let <var>result</var> be <var>asyncBody</var>().</ins></li></ol></li><li><del>Let <var>result</var> be the result of evaluating <var>asyncBody</var>. </del></li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: If we return here, the async function either threw an exception or performed an implicit or explicit return; all awaiting is done.</li><li>Remove <var>asyncContext</var> from the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref> and restore the <emu-xref href="#sec-execution-contexts"><a href="https://tc39.es/ecma262/#sec-execution-contexts">execution context</a></emu-xref> that is at the top of the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref> as the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>If <var>result</var>.[[Type]] is <emu-const>normal</emu-const>, then<ol><li>Perform !&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>promiseCapability</var>.[[Resolve]], <emu-val>undefined</emu-val>, ¬´ <emu-val>undefined</emu-val> ¬ª).</li></ol></li><li>Else if <var>result</var>.[[Type]] is <emu-const>return</emu-const>, then<ol><li>Perform !&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>promiseCapability</var>.[[Resolve]], <emu-val>undefined</emu-val>, ¬´ <var>result</var>.[[Value]] ¬ª).</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>result</var>.[[Type]] is <emu-const>throw</emu-const>.</li><li>Perform !&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>promiseCapability</var>.[[Reject]], <emu-val>undefined</emu-val>, ¬´ <var>result</var>.[[Value]] ¬ª).</li></ol></li><li id="step-asyncblockstart-return-undefined">Return.</li></ol></li><li>Push <var>asyncContext</var> onto the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref>; <var>asyncContext</var> is now the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Resume the suspended evaluation of <var>asyncContext</var>. Let <var>result</var> be the value returned by the resumed computation.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: When we return here, <var>asyncContext</var> has already been removed from the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref> and <var>runningContext</var> is the currently <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>result</var> is a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion</a></emu-xref> with a value of <emu-val>undefined</emu-val>. The possible sources of completion values are <emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref> or, if the async function doesn't await anything, step <emu-xref href="#step-asyncblockstart-return-undefined" id="_ref_0"><a href="#step-asyncblockstart-return-undefined">3.i</a></emu-xref> above.</li><li>Return.</li></ol></emu-alg>
      </emu-clause>
    </emu-clause>
  </emu-clause>
</emu-clause>

<emu-clause id="sec-indexed-collections">
  <h1><span class="secnum">2</span> Indexed Collections</h1>

  <emu-clause id="sec-array-objects">
    <h1><span class="secnum">2.1</span> Array Objects</h1>

    <emu-clause id="sec-properties-of-the-array-constructor">
      <h1><span class="secnum">2.1.1</span> Properties of the Array Constructor</h1>

      <emu-clause id="sec-array.fromAsync">
        <h1><span class="secnum">2.1.1.1</span> <ins>Array.fromAsync ( <var>asyncItems</var> [ , <var>mapfn</var> [ , <var>thisArg</var> ] ] )</ins></h1>

        <emu-note type="editor"><span class="note">Editor's Note</span><div class="note-contents">
          <p>This section is a wholly new subsection of the <a href="https://tc39.es/ecma262/#sec-properties-of-the-array-constructor">original
          Properties of the Array Constructor clause</a>, to be inserted before the <a href="https://tc39.es/ecma262/#sec-properties-of-the-array-constructor">Array.from
          clause</a>.</p>
        </div></emu-note>

        <p>When the <code>fromAsync</code> method is called, the following steps are taken:</p>
        <emu-alg><ol><li>Let <var>C</var> be the <emu-val>this</emu-val> value.</li><li>Let <var>promiseCapability</var> be !&nbsp;<emu-xref aoid="NewPromiseCapability"><a href="https://tc39.es/ecma262/#sec-newpromisecapability">NewPromiseCapability</a></emu-xref>(<emu-xref href="#sec-promise-constructor"><a href="https://tc39.es/ecma262/#sec-promise-constructor">%Promise%</a></emu-xref>).</li><li>Let <var>fromAsyncClosure</var> be a new <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with no parameters that captures <var>C</var>, <var>mapfn</var>, and <var>thisArg</var> and performs the following steps when called:<ol><li>If <var>mapfn</var> is <emu-val>undefined</emu-val>, let <var>mapping</var> be <emu-val>false</emu-val>.</li><li>Else,<ol><li>If <emu-xref aoid="IsCallable"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>mapfn</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>mapping</var> be <emu-val>true</emu-val>.</li></ol></li><li>Let <var>usingAsyncIterator</var> be ?&nbsp;<emu-xref aoid="GetMethod"><a href="https://tc39.es/ecma262/#sec-getmethod">GetMethod</a></emu-xref>(<var>asyncItems</var>, <emu-xref href="#sec-well-known-symbols"><a href="https://tc39.es/ecma262/#sec-well-known-symbols">@@asyncIterator</a></emu-xref>).</li><li>If <var>usingAsyncIterator</var> is <emu-val>undefined</emu-val>, then<ol><li>Let <var>usingSyncIterator</var> be ?&nbsp;<emu-xref aoid="GetMethod"><a href="https://tc39.es/ecma262/#sec-getmethod">GetMethod</a></emu-xref>(<var>asyncItems</var>, <emu-xref href="#sec-well-known-symbols"><a href="https://tc39.es/ecma262/#sec-well-known-symbols">@@iterator</a></emu-xref>).</li></ol></li><li>If <emu-xref aoid="IsConstructor"><a href="https://tc39.es/ecma262/#sec-isconstructor">IsConstructor</a></emu-xref>(<var>C</var>) is <emu-val>true</emu-val>, then<ol><li>Let <var>A</var> be ?&nbsp;<emu-xref aoid="Construct"><a href="https://tc39.es/ecma262/#sec-construct">Construct</a></emu-xref>(<var>C</var>).</li></ol></li><li>Else,<ol><li>Let <var>A</var> be !&nbsp;<emu-xref aoid="ArrayCreate"><a href="https://tc39.es/ecma262/#sec-arraycreate">ArrayCreate</a></emu-xref>(0).</li></ol></li><li>Let <var>iteratorRecord</var> be <emu-val>undefined</emu-val>.</li><li>If <var>usingAsyncIterator</var> is not <emu-val>undefined</emu-val>, then<ol><li>Set <var>iteratorRecord</var> to ?&nbsp;<emu-xref aoid="GetIterator"><a href="https://tc39.es/ecma262/#sec-getiterator">GetIterator</a></emu-xref>(<var>asyncItems</var>, <emu-const>async</emu-const>, <var>usingAsyncIterator</var>).</li></ol></li><li>Else if <var>usingSyncIterator</var> is not <emu-val>undefined</emu-val>, then<ol><li>Set <var>iteratorRecord</var> to ?&nbsp;<emu-xref aoid="CreateAsyncFromSyncIterator"><a href="https://tc39.es/ecma262/#sec-createasyncfromsynciterator">CreateAsyncFromSyncIterator</a></emu-xref>(<emu-xref aoid="GetIterator"><a href="https://tc39.es/ecma262/#sec-getiterator">GetIterator</a></emu-xref>(<var>asyncItems</var>, <emu-const>sync</emu-const>, <var>usingSyncIterator</var>)).</li></ol></li><li>If <var>iteratorRecord</var> is not <emu-val>undefined</emu-val>, then<ol><li>Let <var>k</var> be 0.</li><li>Repeat,<ol><li>If <var>k</var> ‚â• 2<sup>53</sup> - 1, then<ol><li>Let <var>error</var> be <emu-xref aoid="ThrowCompletion"><a href="https://tc39.es/ecma262/#sec-throwcompletion">ThrowCompletion</a></emu-xref>(a newly created <emu-val>TypeError</emu-val> object).</li><li>Return ?&nbsp;<emu-xref aoid="AsyncIteratorClose"><a href="https://tc39.es/ecma262/#sec-asynciteratorclose">AsyncIteratorClose</a></emu-xref>(<var>iteratorRecord</var>, <var>error</var>).</li></ol></li><li>Let <var>Pk</var> be !&nbsp;<emu-xref aoid="ToString"><a href="https://tc39.es/ecma262/#sec-tostring">ToString</a></emu-xref>(<emu-xref aoid="ùîΩ"><a href="https://tc39.es/ecma262/#ùîΩ">ùîΩ</a></emu-xref>(<var>k</var>)).</li><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(<emu-xref aoid="IteratorStep"><a href="https://tc39.es/ecma262/#sec-iteratorstep">IteratorStep</a></emu-xref>(<var>iteratorRecord</var>)).</li><li>If <var>next</var> is <emu-val>false</emu-val>, then<ol><li>Perform ?&nbsp;<emu-xref aoid="Set"><a href="https://tc39.es/ecma262/#sec-set-o-p-v-throw">Set</a></emu-xref>(<var>A</var>, <emu-val>"length"</emu-val>, <emu-xref aoid="ùîΩ"><a href="https://tc39.es/ecma262/#ùîΩ">ùîΩ</a></emu-xref>(<var>k</var>), <emu-val>true</emu-val>).</li><li>Return <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">Completion Record</a></emu-xref> { [[Type]]: <emu-const>return</emu-const>, [[Value]]: <var>A</var>, [[Target]]: <emu-const>empty</emu-const> }.</li></ol></li><li>Let <var>nextValue</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>If <var>mapping</var> is <emu-val>true</emu-val>, then<ol><li>Let <var>mappedValue</var> be <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>mapfn</var>, <var>thisArg</var>, ¬´ <var>nextValue</var>, <emu-xref aoid="ùîΩ"><a href="https://tc39.es/ecma262/#ùîΩ">ùîΩ</a></emu-xref>(<var>k</var>) ¬ª).</li><li><emu-xref href="#sec-ifabruptcloseasynciterator" id="_ref_2"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>mappedValue</var>, <var>iteratorRecord</var>).</li><li>Set <var>mappedValue</var> to <emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(<var>mappedValue</var>).</li><li><emu-xref href="#sec-ifabruptcloseasynciterator" id="_ref_3"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>mappedValue</var>, <var>iteratorRecord</var>).</li></ol></li><li>Else, let <var>mappedValue</var> be <var>nextValue</var>.</li><li>Let <var>defineStatus</var> be <emu-xref aoid="CreateDataPropertyOrThrow"><a href="https://tc39.es/ecma262/#sec-createdatapropertyorthrow">CreateDataPropertyOrThrow</a></emu-xref>(<var>A</var>, <var>Pk</var>, <var>mappedValue</var>).</li><li>If <var>defineStatus</var> is an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>, return ?&nbsp;<emu-xref aoid="AsyncIteratorClose"><a href="https://tc39.es/ecma262/#sec-asynciteratorclose">AsyncIteratorClose</a></emu-xref>(<var>iteratorRecord</var>, <var>defineStatus</var>).</li><li>Set <var>k</var> to <var>k</var> + 1.</li></ol></li></ol></li><li>Else,<ol><li>NOTE: <var>asyncItems</var> is neither an AsyncIterable nor an Iterable so assume it is an <emu-xref href="#sec-lengthofarraylike"><a href="https://tc39.es/ecma262/#sec-lengthofarraylike">array-like object</a></emu-xref>.</li><li>Let <var>arrayLike</var> be !&nbsp;<emu-xref aoid="ToObject"><a href="https://tc39.es/ecma262/#sec-toobject">ToObject</a></emu-xref>(<var>asyncItems</var>).</li><li>Let <var>len</var> be ?&nbsp;<emu-xref aoid="LengthOfArrayLike"><a href="https://tc39.es/ecma262/#sec-lengthofarraylike">LengthOfArrayLike</a></emu-xref>(<var>arrayLike</var>).</li><li>If <emu-xref aoid="IsConstructor"><a href="https://tc39.es/ecma262/#sec-isconstructor">IsConstructor</a></emu-xref>(<var>C</var>) is <emu-val>true</emu-val>, then<ol><li>Let <var>A</var> be ?&nbsp;<emu-xref aoid="Construct"><a href="https://tc39.es/ecma262/#sec-construct">Construct</a></emu-xref>(<var>C</var>, ¬´ <emu-xref aoid="ùîΩ"><a href="https://tc39.es/ecma262/#ùîΩ">ùîΩ</a></emu-xref>(<var>len</var>) ¬ª).</li></ol></li><li>Else,<ol><li>Let <var>A</var> be ?&nbsp;<emu-xref aoid="ArrayCreate"><a href="https://tc39.es/ecma262/#sec-arraycreate">ArrayCreate</a></emu-xref>(<var>len</var>).</li></ol></li><li>Let <var>k</var> be 0.</li><li>Repeat, while <var>k</var> &lt; <var>len</var>,<ol><li>Let <var>Pk</var> be !&nbsp;<emu-xref aoid="ToString"><a href="https://tc39.es/ecma262/#sec-tostring">ToString</a></emu-xref>(<emu-xref aoid="ùîΩ"><a href="https://tc39.es/ecma262/#ùîΩ">ùîΩ</a></emu-xref>(<var>k</var>)).</li><li>Let <var>kValue</var> be ?&nbsp;<emu-xref aoid="Get"><a href="https://tc39.es/ecma262/#sec-get-o-p">Get</a></emu-xref>(<var>arrayLike</var>, <var>Pk</var>).</li><li>Set <var>kValue</var> to ?&nbsp;<emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(<var>kValue</var>).</li><li>If <var>mapping</var> is <emu-val>true</emu-val>, then<ol><li>Let <var>mappedValue</var> be ?&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>mapfn</var>, <var>thisArg</var>, ¬´ <var>kValue</var>, <emu-xref aoid="ùîΩ"><a href="https://tc39.es/ecma262/#ùîΩ">ùîΩ</a></emu-xref>(<var>k</var>) ¬ª).</li><li>Set <var>mappedValue</var> to ?&nbsp;<emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(<var>mappedValue</var>).</li></ol></li><li>Else, let <var>mappedValue</var> be <var>kValue</var>.</li><li>Perform ?&nbsp;<emu-xref aoid="CreateDataPropertyOrThrow"><a href="https://tc39.es/ecma262/#sec-createdatapropertyorthrow">CreateDataPropertyOrThrow</a></emu-xref>(<var>A</var>, <var>Pk</var>, <var>mappedValue</var>).</li><li>Set <var>k</var> to <var>k</var> + 1.</li></ol></li><li>Perform ?&nbsp;<emu-xref aoid="Set"><a href="https://tc39.es/ecma262/#sec-set-o-p-v-throw">Set</a></emu-xref>(<var>A</var>, <emu-val>"length"</emu-val>, <emu-xref aoid="ùîΩ"><a href="https://tc39.es/ecma262/#ùîΩ">ùîΩ</a></emu-xref>(<var>len</var>), <emu-val>true</emu-val>).</li><li>Return <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">Completion Record</a></emu-xref> { [[Type]]: <emu-const>return</emu-const>, [[Value]]: <var>A</var>, [[Target]]: <emu-const>empty</emu-const> }.</li></ol></li></ol></li><li>Perform <emu-xref aoid="AsyncFunctionStart"><a href="https://tc39.es/ecma262/#sec-async-functions-abstract-operations-async-function-start">AsyncFunctionStart</a></emu-xref>(<var>promiseCapability</var>, <var>fromAsyncClosure</var>).</li><li>Return <var>promiseCapability</var>.[[Promise]].</li></ol></emu-alg>
        <emu-note><span class="note">Note</span><div class="note-contents">
          <p>The <code>fromAsync</code> function is an intentionally generic factory method; it does not require that its <emu-val>this</emu-val> value be the Array <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>. Therefore it can be transferred to or inherited by any other <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructors</a></emu-xref> that may be called with a single numeric argument.</p>
        </div></emu-note>
      </emu-clause>
    </emu-clause>
  </emu-clause>
</emu-clause>
</div></body>